## 1. 배경

### 1.1 크로스 브라우징

- 사용하는 말이 달라서 바벨탑이 실패했듯이, 브라우져마다 사용하는 언어가 달라서 프론트엔트 코드는 일관적이지 못할 때가 많다.

- 스팩과 브라우져가 개선되고 있지만, 여전히 인터넷 익스플로러는 프라미스를 이해하지 못한다.

- 몇년 전만 해도 사파리 최신 브라우져는 Promise.prototype.finally 메소드를 사용할 수 없었기 때문에 해당하는 폴리필을 넣어주는 방식으로 문제를 해결했다.

- 프론트엔드 개발에서 크로스브라우징 이슈는 코드의 일관성을 해치고 초심자를 불안하게 만든다. 히브리어로 바벨이 '혼돈'이란 뜻인 것처럼 말이다.

- 크로스브라우징의 혼란을 해결해 줄 수 있는 것이 바벨이다.

- ECMAScript2015+로 작성한 코드를 모든 브라우져에서 동작하도록 호환성을 지켜준다.

- 타입스크립트, JSX처럼 다른 언어로 분류되는 것도 포함한다.

- 예를들면 리액트 어플리케이션을 만들때 아래 코드를 사용하는데, jsx 문법을 사용해서 루트 컴포넌트를 사용하고 있다.

- 브라우져는 jsx코드를 모르니깐 누군가 변경해 주어야 하는데, 바로 "바벨"의 역할이다.

```jsx
ReactDOM.render(<Root />, document.getElementById("root"));
```

- 바벨이 코드를 jsx를 리액트 앨리먼트로 변환하는데 js 코드 형태로 이걸 render() 함수의 인자로 전달하는 순서이다다.

### 1.2 트랜스파일과 빌드

- 이렇게 변환하는 것을 "트랜스파일" 한다라고 표현한다.

- 변환 전후의 추상화 수준이 다른 빌드와는 달리 트랜스파일은 추상화 수준을 유지한 상태로 코드를 변환한다.

- 타입스크립트 → 자바스크립트, JSX → 자바스크립트처럼 트랜스파일 후에도 여전히 코드를 읽을 수 있다.

- 요즘에는 이 둘을 구분하지 않고 사용하는 것 같다.

## 2. 바벨의 기본 동작

- 바벨은 ECMAScript2015 이상의 코드를 적당한 하위 버전으로 바꾸는 것이 주된 역할이다.

- 이렇게 바뀐 코드는 인터넷 익스프로러나 구버전 브라우져처럼 최신 자바스크립트 코드를 이해하지 못하는 환경에서도 잘 동작한다.

- 바벨을 이용해 아래 코드를 인터넷 익스플로러가 이해할 수 있는 코드로 바꿔 보겠다.

```js
// src/app.js:

const alert = (msg) => window.alert(msg);
```

- 먼저 바벨 최신 버전를 설치한다. 터미널 도구를 사용하기 위해 커맨드라인 도구도 함께 설치하자.

```shell
npm install -D @babel/core @babel/cli

```

- 설치를 완료후 `node_modules/.bin` 폴더에 추가된 바벨 명령어를 사용할 수 있다.

```shell
# npx 명령어를 사용해서 babel 명령어를 바로 실행할 수도 있다.
npx babel app.js

const alert = (msg) => window.alert(msg); # 명령어를 실행하면 해당 코드가 터미널에 출력된다

```

- 바벨은 세 단계로 빌드를 진행한다.

  1. 파싱 (Parsing)

  2. 변환 (Transforming)

  3. 출력 (Printing)

- 코드를 읽고 추상 구문 트리(AST)로 변환하는 단계를 `"파싱"`이라고 한다.

- 이것은 빌드 작업을 처리하기에 적합한 자료구조인데 컴파일러 이론에 사용되는 개념이다.

- 추상 구문 트리를 변경하는 것이 `"변환"` 단계이다. 실제로 코드를 변경하는 작업을 한다.

- 변경된 결과물을 `"출력"`하는 것을 마지막으로 바벨은 작업을 완료한다.

- 그런데 위에서 npx 명령어를 결과를 보면 빌드 이전과 변한게 하나도 없다.

- 그 이유는 파싱은 했지만 변환을 하지 않고 출력을 했기 때문이다

- 바벨에는 플러그인이라는 요소가 있는데 이 플러그인이 변환을 담당하는 요소이다.

### Q.

- 1. 프롬프트상 바벨로 에러없이 변환 성공했을때, 항상 구버전 브라우저(IE11등)에서 동작하는것을 보장해주나요? ( 휴먼 코드 에러같은 것을 제외하고 )

- 2. 1번과 동일선상에 질문입니다. JQuery, Vue, React의 라이브러리(Component)들을 사용하다보면, 버전업 되면서 점점 "IE11는 더이상 지원 안함"이라고 되어있더라고요, 이런것도 바벨을 돌려서 IE11에서 돌아가게 할 수 있나요??

### A.

- 1. 바벨은 ECMAScript 상위버전을 하위 버전으로 변환하는 역할을 하는데요, 구버전 브라우져에서 이해할수 있는 코드로 변환합니다.

  - const를 var로 변환해주는게 그 역할이죠. 그럼에도 불구하고 구버전에서 항상 돌아가는 코드를 만들려면 "폴리필"을 사용해야 합니다.

  - 바벨 설정에는 corejs 라는 폴리필을 내부적으로 사용하고 있고요.

- 관련한 블로그 글도 남김니다.

  - https://jeonghwan-kim.github.io/series/2019/12/22/frontend-dev-env-babel.html#52-%ED%8F%B4%EB%A6%AC%ED%95%84

- 2. 제 기억으로는 언급해 주신 라이브러리들이 IE11을 지원했던 걸로 알고 있습니다. 대신 mobx 최신버전이 ie11을 지원하지 않는다는 문서를 본것 같아요. 그래서 최신버전을 사용하지 않고 지원하는 하위버전을 사용했던 경험이 있습니다.

<br/>

### Q. @babel/core라는 것은 파싱과 출력을 담당하고 플러그인을 통해서 변환과정을 거치는거죠 ?

### A. 네 그렇습니다.

> "Now, out of the box Babel doesn't do anything. It basically acts like const babel = code => code; by parsing the code and then generating the same code back out again. You will need to add plugins for Babel to do anything."

- https://babeljs.io/docs/en/plugins
